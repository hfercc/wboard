{% extends "base.html" %}
{% block main_content %}
  <div class="container" data-spy="scroll" data-target=".panel-group">
    <div class="panel-group" id="pmListContainer">
    </div>
  </div>
  <script src="/static/js/list.js"></script>
  <script type="text/javascript">
    pmList = new List("pmList","#pmList","<div class='panel panel-default'>"+
                      "<div class='panel-heading'><h4 class='panel-title'><a data-toggle='modal' data-target='#charModal'>{sender}</a></h4></div>"+
                      "</div>",{limits:20});
    pmList.update(); 
  </script>
  <div class="modal fade" id="chatModal" aria-hidden="true" role="dialog" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="usertag"></h4>
        </div>
        <div class="modal-body" id="messagetag">
        </div>
        <div class="modal-footer">
          <form role="form" id="formMessage"> 
            <div class="form-group">
			     <textarea class="form-control" rows="5" placeholder="请在这输入评论" name="body_text"></textarea>
		      </div>
		      <input type="hidden" name="receivers" value="{{object.sender}}">
		      <div class="form-group">
			     <button type="button" id="formCommentSubmit" class="pull-right btn btn-primary">提交</button>
		      </div>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <button type="button" class="btn btn-primary" id="sendMessage">发送</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    $('.panel a').click(function(){
      var uname = $(this).text();
      $('#usertag').append(uname);
      $('#messagetag').append('<p>{{object.body_text}}</p><br><p>{{object.sender}}@{{object.created_time}}</p>'); 
    });
    $("#sendMessage").click(function(){
      var data = api.normal("pmWrite",function(){ pmList.update()},$(#formMessage).serialize());
    });
  </script>
{% endblock %}